var Util=Util||{};(function(b){"use strict";var a=function(o,c){var n=document.getElementById(o);if(n){var t=n.innerHTML,i="src",e="",m="",p="",l="",w="",g="";c&a.FLAG_LAZYLOAD&&(g="lazyload",i="data-src",e='class="'+g+'" '),c&a.FLAG_MAX_SIZE&&(w="max-width:120px;max-height:120px;",m='style="'+w+'" '),c&a.FLAG_LINE_BREAK&&(p="<br>"),c&a.FLAG_STOP_EVENT&&(l="event.stopPropagation();"),t=t.replace(/(<[^>]*)h(ttp[s]{0,1}:\/\/[^>]*>)/gi,"$1b$2"),c&a.FLAG_BALA_PLAYER?(t=t.replace(/&amp;start/g,"&start"),t=t.replace(/&amp;list/g,"&list"),t=t.replace(/https?:\/\/www\.youtube\.com\/watch\?v=([0-9a-zA-Z_-]{11})(&start=[\d]+)?/gi,'<p style=" display:block; width:138px; height:77px; position:relative; background:url(bttps://i1.ytimg.com/vi/$1/default.jpg) no-repeat center center;" onclick="'+l+`$(this).html('<iframe width=450 height=253 src=bttps://www.youtube.com/embed/$1?autoplay=1&$2 frameborder=0 allowfullscreen></iframe>');$(this).css('width','450px');$(this).css('height','253px');"><img src="bttps://i2.bahamut.com.tw/icon_videoplayer.svg" style="cursor: pointer; position: absolute; top:50%; left: 50%; width: 30%; max-height: 50%; transform: translate(-50%, -50%);"></p>`),t=t.replace(/https?:\/\/youtu\.be\/([0-9a-zA-Z_-]{11})(?:\?(start=[\d]+))?/gi,'<p style=" display:block; width:138px; height:77px; position: relative; background:url(bttps://i1.ytimg.com/vi/$1/default.jpg) no-repeat center center;" onclick="'+l+`$(this).html('<iframe width=450 height=253 src=bttps://www.youtube.com/embed/$1?autoplay=1&$2 frameborder=0 allowfullscreen></iframe>');$(this).css('width','450px');$(this).css('height','253px');"><img src="bttps://i2.bahamut.com.tw/icon_videoplayer.svg" style="cursor: pointer; position: absolute; top:50%; left: 50%; width: 30%; max-height: 50%; transform: translate(-50%, -50%);"></p>`),t=t.replace(/h(ttps?:\/\/www\.facebook\.com\/(\w+)\/videos\/(\d+)\/)/gi,'<p style=" display:block; width:138px; height:77px; position: relative; background:url(bttps://graph.facebook.com/$3/picture) no-repeat center center;" onclick="'+l+`$(this).html('<iframe src=bttps://www.facebook.com/plugins/video.php?autoplay=true&href=b$1&width=450&show_text=false&height=253&appId width=450 height=253 style=border:none;overflow:hidden scrolling=no frameborder=0 allowTransparency=true allow=encrypted-media allowFullScreen=true></iframe>');$(this).css('width','450px');$(this).css('height','253px');"><img src="bttps://i2.bahamut.com.tw/icon_videoplayer.svg" style="cursor: pointer; position: absolute; top:50%; left: 50%; width: 30%; max-height: 50%; transform: translate(-50%, -50%);"></p>`),t=t.replace(/https?:\/\/(?:www|tw)\.nicovideo\.jp\/watch\/((?:sm|nm|ca|cd|ax|yo|nl|ig|na|cw|za|zb|zc|zd|ze|om|sk|yk|so|am|fz)[0-9]{1,14}|[0-9]{10})/g,function(h,r){return'<p style=" display:block; width:138px; height:77px; position: relative; background:url(bttp://tn-skr3.smilevideo.jp/smile?i='+r.replace(/sm|nm|ca|cd|ax|yo|nl|ig|na|cw|za|zb|zc|zd|ze|om|sk|yk|so|am|fz/,"")+') no-repeat center center;" onclick="'+l+"$(this).html('<iframe width=450 height=253 src=bttps://embed.nicovideo.jp/watch/"+r+` frameborder=0 allowfullscreen></iframe>');$(this).css('width','450px');$(this).css('height','253px');"><img src="bttps://i2.bahamut.com.tw/icon_videoplayer.svg" style="width: 30px; cursor: pointer; position: absolute; top:50%; left: 50%; width: 30%; max-height: 50%; transform: translate(-50%, -50%);"></p>`})):(t=t.replace(/https?:\/\/www\.youtube\.com\/watch\?v=([0-9a-zA-Z_-]{11})/gi,p+"<iframe "+e+i+'="bttps://www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>'),t=t.replace(/https?:\/\/youtu\.be\/([0-9a-zA-Z_-]{11})/gi,p+"<iframe "+e+i+'="bttps://www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>'),t=t.replace(/h(ttps?:\/\/www\.facebook\.com\/\w+\/videos\/\d+\/)/gi,p+"<iframe "+e+i+'="b$1  frameborder=0 allowfullscreen></iframe>'),t=t.replace(/https?:\/\/(?:www|tw)\.nicovideo\.jp\/watch\/((?:sm|nm|ca|cd|ax|yo|nl|ig|na|cw|za|zb|zc|zd|ze|om|sk|yk|so|am|fz)[0-9]{1,14}|[0-9]{10})/g,function(h,r){return p+'<a href="'+encodeURI(h).replace("http","bttp")+'"  onclick="'+l+'Util.ChangeText.refurl(this);" target="_blank" style="display: inline-block; position: relative;"><img src="bttps://i2.bahamut.com.tw/icon_videoplayer.svg" style="position: absolute; top: 50%; left: 50%; width: 24%; max-height: 50%; transform: translate(-50%, -50%);"><div style="background: #000000 url(bttp://tn-skr3.smilevideo.jp/smile?i='+r.replace(/sm|nm|ca|cd|ax|yo|nl|ig|na|cw|za|zb|zc|zd|ze|om|sk|yk|so|am|fz/,"")+') center center no-repeat; background-size: contain; width: 425px; height: 250px;"></div></a>'})),t=t.replace(/h(ttps?:\/\/[!#-&(-;=?-Z\^-~]+)/gi,function(h){let r=null;try{r=new URL(h.replace(/&(?:lt|gt|quot|#039|amp);/g,function(d){return{"&lt;":"<","&gt;":">","&quot;":'"',"&#039":"'","&amp;":"&"}[d]}))}catch(d){return h}var s=document.createElement("a");if(s.setAttribute("href","b"+r.href.slice(1)),s.setAttribute("target","_blank"),s.setAttribute("onclick",`${l} Util.ChangeText.refurl(this);`),r.pathname.match(/\.(?:jpe?g|png|gif|webp)$/i)){var u=document.createElement("img");u.setAttribute(i,"b"+r.href.slice(1)),w!=""&&u.setAttribute("style",w),g!=""&&u.setAttribute("class",g),s.appendChild(u),r.hostname.match(/\.bahamut\.com\.tw$/)&&(r.searchParams.delete("w"),r.searchParams.delete("h"),r.searchParams.delete("fit"),s.setAttribute("href","b"+r.href.slice(1))),r.href.match(/^https:\/\/im\.bahamut\.com\.tw\/sticker\//)?(s.setAttribute("href","javascript:;"),s.removeAttribute("target"),s.removeAttribute("onclick")):jQuery(".pswp").length>0&&(s.setAttribute("href","javascript:;"),s.setAttribute("target",""),s.setAttribute("onclick",`${l} Util.ChangeText.openPswp(this);`))}else s.innerHTML=r;return`${p}`+s.outerHTML}),t=t.replace(/\[e(\d*)\]/gi,"<img "+e+i+'="https://i2.bahamut.com.tw/editor/emotion/$1.gif">'),typeof gsn<"u"&&(t=t.replace(/\[G(1[a-z0-9]{3})\]/gi,"<img "+e+i+'="https://p2.bahamut.com.tw/B/GUILD/e/'+gsn%10+"/"+gsn+'_$1.GIF">'),t=t.replace(/\[G(2[a-z0-9]{3})\]/gi,"<img "+e+i+'="https://p2.bahamut.com.tw/B/GUILD/e/'+gsn%10+"/"+gsn+'_$1.JPG">'),t=t.replace(/\[G(3[a-z0-9]{3})\]/gi,"<img "+e+i+'="https://p2.bahamut.com.tw/B/GUILD/e/'+gsn%10+"/"+gsn+'_$1.PNG">')),t=t.replace(/\[G([0-9]{1}\/\d*_1[a-z0-9]{3})\]/gi,"<img "+e+i+'="https://p2.bahamut.com.tw/B/GUILD/e/$1.GIF">'),t=t.replace(/\[G([0-9]{1}\/\d*_2[a-z0-9]{3})\]/gi,"<img "+e+i+'="https://p2.bahamut.com.tw/B/GUILD/e/$1.JPG">'),t=t.replace(/\[G([0-9]{1}\/\d*_3[a-z0-9]{3})\]/gi,"<img "+e+i+'="https://p2.bahamut.com.tw/B/GUILD/e/$1.PNG">'),t=t.replace(/a>：\[([0-9a-zA-Z]*):([^\]]*)\]/gi,'a> &gt; <a class="msgname AT1" href="http://home.gamer.com.tw/bahawall.php?owner=$1" target="_blank">$2</a>'),t=t.replace(/：\[([0-9a-zA-Z]*):([^\]]*)\]/gi,'\u3001<a class="msgname AT1" href="http://home.gamer.com.tw/bahawall.php?owner=$1" target="_blank">$2</a>'),t=t.replace(/\[([0-9a-zA-Z]*):([^\]]*)\]/gi,'<a class="msgname AT1" href="http://home.gamer.com.tw/bahawall.php?owner=$1" target="_blank">$2</a>'),t=t.replace(/b(ttp[s]{0,1}:\/\/)/gi,"h$1"),n.innerHTML=t,window.GamerCard&&window.GamerCard.bind("#"+o)}};a.refurl=function(o){o.href.match(/^https?:\/\/ref\.gamer\.com\.tw/)||(o.href="https://ref.gamer.com.tw/redir.php?url="+encodeURIComponent(o.href))},a.openPswp=function(o){let c=jQuery(o),n={captionEl:!1,bgOpacity:.85,showHideOpacity:!0,history:!1,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">\u5716\u7247</a>\u7121\u6CD5\u8F09\u5165</div>',shareEl:!1,index:0},t=new PhotoSwipe($(".pswp").get(0),PhotoSwipeUI_Default,[{src:c.find("img").data("src"),w:0,h:0}],n);t.listen("gettingData",function(i,e){if(e.onLoading===void 0&&(e.w<1||e.h<1)){e.onLoading=!0;let m=new Image;m.onload=function(){e.w=this.width,e.h=this.height,t.invalidateCurrItems(),t.updateSize(!0)},m.src=e.src}}),t.init()},a.FLAG_LAZYLOAD=1,a.FLAG_MAX_SIZE=2,a.FLAG_LINE_BREAK=4,a.FLAG_BALA_PLAYER=8,a.FLAG_STOP_EVENT=16,a.FLAG_BALA=a.FLAG_LAZYLOAD|a.FLAG_MAX_SIZE|a.FLAG_LINE_BREAK|a.FLAG_BALA_PLAYER,b.ChangeText=a})(Util);
