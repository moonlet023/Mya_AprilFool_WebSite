function getTop(e){for(var t=0;e;)t+=e.offsetTop,e=e.offsetParent;return t}function getLeft(e){for(var t=0;e;)t+=e.offsetLeft,e=e.offsetParent;return t}function notactive(e,t,a){if(1==a){var r=document.createElement("div");r.id="reporttxt",r.style.position="absolute",r.style.border="1px solid #b46600",r.style.background="#fffad2",r.style.width="183px",r.style.height="38px",r.style.padding="3px",e.id="tmpme",r.style.top=egg("#tmpme").pos().y-48+"px",r.style.left=egg("#tmpme").pos().x+"px",e.id="",r.innerHTML=t,document.body.appendChild(r)}else try{document.body.removeChild(egg("#reporttxt").get()[0])}catch(n){}return!1}function m3(e,t,a){if(1==a){if("noDATAcss"===e){e=egg(".IMG-E42").attr("id");var r="noDATAcss"}var n=document.createElement("div");if(n.id="m3txt",n.style.position="absolute",n.style.border="1px solid #b46600",n.style.background="#fffad2",n.style.padding="3px",n.style.top=egg("#"+e).pos().y+130+"px",n.style.left=egg("#"+e).pos().x+39+"px",n.innerHTML=t,"collectNew"===e.substr(0,10))n.style.top=egg("#"+e).pos().y-26+"px";else if("pushdaren_"===e.substr(0,10))n.style.left=egg("#"+e).pos().x+3+"px",n.style.top=egg("#"+e).pos().y-42+"px";else if("acgVoteBox"===e)n.style.top=egg("#"+e).pos().y+70+"px",n.style.left=egg("#"+e).pos().x-3+"px";else if("noDATAcss"===r){var l=new Array;l[1]=new Array,l[1][1]="IMG-E37",l[1][2]="IMG-E38",l[1][3]="IMG-E36",l[1][4]="IMG-E35",l[2]=new Array,l[2][1]="IMG-E41",l[2][2]="IMG-E38",l[2][3]="IMG-E39",l[2][4]="IMG-E40",l[4]=l[2],l[8]=l[2],n.style.top=egg("#"+e).pos().y-5+"px",n.style.left=egg("#"+e).pos().x+70+"px",egg(".IMG-E42").attr("onclick","").click(function(){alert("您已經收藏了喔～")}),egg(".IMG-E42").attr("className",l[e.charAt(9)][e.charAt(11)])}document.body.appendChild(n),setTimeout("m3('','','2')",3e3)}else try{document.body.removeChild(egg("#m3txt").get()[0])}catch(o){}return!1}function open_default(e,t,a){0===e.length&&(e="訊息"),egg.lightbox.close();var r="";r+='<div class="open_win">',r+='  <h1 class="open_wintitle"><img src="https://i2.bahamut.com.tw/h1_img.gif" />'+e+"</h1>",r+="  <div>"+t+"</div>",r+='  <p class="open_winbtn">'+a+"</p>",r+="</div>",egg.lightbox(r,{hide:"select, object, embed, iframe"}),egg.lightbox.refresh(r),egg("div[class=open_win]").css("text-align","left")}function playstatus(e,t){egg.ajax({url:"/ajax/myplaystatus.php",success:replaystatus,param:"s="+e+"&w="+t,method:"GET"})}function replaystatus(e){var t=e.getElementsByTagName("errMsg"),a="";if(t.length)a=t[0].firstChild.nodeValue,open_default("",a,'<input type="button" value="確定" onclick="egg.lightbox.close();" />');else{var r="",n="",l="",o="";0!==e.getElementsByTagName("want2play").length&&(r="checked"),0!==e.getElementsByTagName("playing").length&&(n="checked"),0!==e.getElementsByTagName("played").length&&(l="checked"),0!==e.getElementsByTagName("favorite").length&&(o="checked");var i=e.getElementsByTagName("acg_sn")[0].firstChild.nodeValue,s=e.getElementsByTagName("word")[0].firstChild.nodeValue,g=e.getElementsByTagName("where")[0].firstChild.nodeValue;a+="設定作品狀態：<br>",a+='<input type="radio" name="play" id="play_wp" '+r+">我想"+s+"<br>",a+='<input type="radio" name="play" id="play_p" '+n+">正在"+s+"<br>",a+='<input type="radio" name="play" id="play_pd" '+l+">已"+s+"過<br>",a+='<input type="checkbox" id="favorite" '+o+"> 這是我最喜歡的作品之一",open_default("",a,'<input type="button" value="確定" onclick="changeplay('+i+",'"+g+'\');" /><input type="button" value="取消" onclick="egg.lightbox.close();" />')}}function changeplay(e,t,a,r){if(void 0===a&&void 0===r){var n=egg("#play_wp").get();n[0].checked===!0&&(a=1),n=egg("#play_p").get(),1==n[0].checked&&(a=2),n=egg("#play_pd").get(),1==n[0].checked&&(a=3),n=egg("#favorite").get(),1==n[0].checked&&(r=1)}return egg.lightbox.close(),egg.ajax({url:"/ajax/changeplay.php",success:rechangeplay,param:"s="+e+"&p="+a+"&f="+r+"&w="+t,method:"GET"}),!1}function rechangeplay(e){var t=e.getElementsByTagName("errMsg"),a=e.getElementsByTagName("okMsg"),r=egg("acg_sn",e).val(),n="";if(0!==t.length)n=t[0].firstChild.nodeValue,open_default("",n,'<input type="button" value="確定" onclick="egg.lightbox.close();" />');else if(0!==a.length){var l=e.getElementsByTagName("where")[0].firstChild.nodeValue;if("a"===l){var o=e.getElementsByTagName("html")[0].firstChild.nodeValue;egg("#newscore"+r).html(o),m3("newscore"+r,'完成設定，已收藏至<a href="http://home.gamer.com.tw/acgbox.php?owner='+egg.cookie.get("BAHAID")+'" target="_blank" style="color:blue"> 遊戲動漫櫃</a>',"1")}else if("ap"===l){var o=e.getElementsByTagName("html")[0].firstChild.nodeValue;egg("#playlist").html(o)}else if("noDATA"===l)m3("noDATAcss",'已收藏至<a href="http://home.gamer.com.tw/acgbox.php?owner='+egg.cookie.get("BAHAID")+'">遊戲動漫櫃</a>！之後可在「<a href="http://home.gamer.com.tw/bahawall.php?owner='+egg.cookie.get("BAHAID")+'">動態中心</a>」持續收<br>到本作品相關資訊。<a href="javascript:window.location.reload(true);">更新本頁內容</a>',"1");else if("button4"===l){var o=e.getElementsByTagName("html")[0].firstChild.nodeValue;egg("#acgVoteBox").html(o),m3("acgVoteBox",'完成設定，已收藏至<a href="http://home.gamer.com.tw/acgbox.php?owner='+egg.cookie.get("BAHAID")+'" target="_blank" style="color:blue"> 遊戲動漫櫃</a>',"1")}else{var s=e.getElementsByTagName("acg_sn")[0].firstChild.nodeValue,g=e.getElementsByTagName("hide")[0].firstChild.nodeValue;"Y"===g&&(showDetal_destroy(),egg("#acgbox_"+s).hide())}}else{var c=e.getElementsByTagName("olddata")[0].firstChild.nodeValue,s=e.getElementsByTagName("acg_sn"),p=e.getElementsByTagName("title"),u=e.getElementsByTagName("word")[0].firstChild.nodeValue,h=e.getElementsByTagName("type")[0].firstChild.nodeValue;for(n+="p"===h?'設定為<span class="BH-tcolor1">正在'+u+"</span>的作品已達十款上限，您必須取消以下其中一款作品的狀態。<br>":'設定為<span class="BH-tcolor1">最喜歡</span>的作品已達十款上限，您必須取消以下其中一款作品的狀態。<br>',n+="<table border=0>",i=0;i<s.length;i+=2)n+='<tr><td><input type="radio" name="delACG" value="'+s[i].firstChild.nodeValue+'">'+p[i].firstChild.nodeValue+'</td><td><input type="radio" name="delACG" value="'+s[i+1].firstChild.nodeValue+'">'+p[i+1].firstChild.nodeValue+"</td></tr>";n+="</table>",open_default("",n,'<input type="button" value="確定" onclick="changeplay2(\''+c+"','"+h+'\');" /><input type="button" value="取消" onclick="egg.lightbox.close();" />')}}function changeplay2(e,t){var a=egg(":radio[name=delACG]").filter("[checked]").val();return"undefined"==a?(alert("請選擇要取消的作品"),!1):(egg.lightbox.close(),void egg.ajax({url:"/ajax/changeplay.php",success:rechangeplay,param:e+"&ds="+a+"&dt="+t,method:"GET"}))}function nextStep(){location.reload()}function acgfeature(e,t){t=t||0,jQuery.ajax({url:"/ajax/get_acgfeature.php",data:{s:e,star:t},cache:!1}).done(function(t){acgfeature_rs(t,e)})}function acgfeature_rs(e,t){var a=e.getElementsByTagName("errMsg"),r="",n="";if(0!==a.length)r+=a[0].firstChild.nodeValue,Dialogify.alert(r);else{var l=parseInt(e.getElementsByTagName("star")[0].firstChild.nodeValue),o="",s=new Array("","差","普通","好","相當優秀","這是我心目中屬一屬二的神作");for(i=1;i<=5;i++)o+='<span onmouseover="Star_func('+i+", '"+s[i]+'\')" onmouseout="Star_func(-1, \'\')" onclick="Star_set('+i+')"><img id="star'+i+'" src="https://i2.bahamut.com.tw/acg/icon_star1a.gif" style="width: 15px; height: 15px; margin-right: 10px;"></span>';n+='<p><span style="font-weight: bolder; font-size: 16px;">總評價：</span>'+o+'<span id="star_explan"></span></p>';var g="",c="";n+='<p style="margin-top: 10px; margin-bottom: 10px; font-weight: bolder; font-size: 13px;">你認為本作品的特色是...(最多<span style="color: #d44950">五項</span>)</p>';var p=e.getElementsByTagName("idata");if(n+='<div style="font-size: 15px; line-height: 24px;">',0!==p.length)for(fi=0;fi<p[0].childNodes.length;fi++){var u="";for(0!==p[0].childNodes[fi].childNodes[2].childNodes.length&&(u="1"==p[0].childNodes[fi].childNodes[2].firstChild.nodeValue?" checked":""),g=p[0].childNodes[fi].childNodes[1].firstChild.nodeValue,c="",space_i=g.length;space_i<5;space_i++)c+="　";n+='<input id="fc'+fi+'" type="checkbox" name="fc[]" onclick="return chk_feature()" style="margin-right: 3px;" value="'+p[0].childNodes[fi].childNodes[0].firstChild.nodeValue+'"'+u+">",n+='<label for="fc'+fi+'" style="margin-right: 10px;">'+g+c+"</label>",(fi+1)%4===0&&(n+="<br>")}switch(n+="</div>",n+='<p style="margin-top: 11px; margin-bottom: 10px; font-weight: bolder; font-size: 13px;">收藏與追蹤</p>',n+='<input type="checkbox" id="track" name="track" style="margin-right: 3px;"><label for="track" style="font-size: 15px; line-height: 24px;">評分後收藏並追蹤本作品</label>',n+='<input type="hidden" name="star" value="'+l+'">',n+='<input type="hidden" name="star_explan">',new Dialogify(n).title("作品評價").buttons([{text:"確定",type:Dialogify.BUTTON_PRIMARY,click:function(){chkdata(t)}},{text:"取消",click:function(){this.close()}}],{position:Dialogify.BUTTON_CENTER}).showModal(),l){case 5:case 4:case 3:case 2:jQuery("#track").prop("checked",!0);case 1:jQuery("#star_explan").text(s[l]),jQuery("input[name=fini]").val(1),Star_set(l)}}}function Star_set(e){e=parseInt(e);var t=jQuery("#star_explan").text();Star_func(e,t),jQuery("input[name=star]").val(e),jQuery("input[name=star_explan]").val(t),1===e?jQuery("#track").prop("checked",!1):jQuery("#track").prop("checked",!0)}function Star_func(e,t){if(-1!==e)for(jQuery("#star_explan").text(t),i=1;i<=5;i++){var a="https://i2.bahamut.com.tw/acg/icon_star1a.gif";t.length>0&&i<=e&&(a="https://i2.bahamut.com.tw/acg/icon_star1.gif"),jQuery("#star"+i).attr("src",a)}else Star_func(jQuery("input[name=star]").val(),jQuery("input[name=star_explan]").val())}function chk_feature(){return jQuery("input[name=fc\\[\\]]:checked").length>5?(Dialogify.alert("特色最多只能選擇五項，請修正。"),!1):!0}function chkdata(e){var t=parseInt(jQuery("input[name=star]").val());if(0===t)return Dialogify.alert("請給個評價喔"),!1;if(!chk_feature())return!1;var a="";jQuery("input[name=fc\\[\\]]:checked").each(function(){a+=0===a.length?"fc[]="+jQuery(this).val():"&fc[]="+jQuery(this).val()});var r=0;jQuery("#track").prop("checked")&&(r=1),jQuery.ajax({url:"/ajax/acgfeaturea.php",data:"s="+e+"&star="+jQuery("input[name=star]").val()+"&track="+r+"&"+a,method:"POST",dataType:"json"}).done(function(t){acgfeaturea_rs(t,e)})}function acgfeaturea_rs(e,t){if(void 0!==e.code)Dialogify.alert(e.message);else{try{showDetal_destroy()}catch(a){}0!==jQuery("#star_"+t).length&&drawStar(t,parseInt(e.star,10));for(var r=[0,0,0,0,0],n=1;n<=e.star;n++)r[n-1]=1;Star_now(r[0],r[1],r[2],r[3],r[4]);var l=jQuery(".anime_name > button");0!==l.length&&(e.track===!0?(l.addClass("ordered"),l.attr("onclick","animefun.delgather("+e.acgSn+", this)")):(l.removeClass("ordered"),l.attr("onclick","animefun.want2play("+e.acgSn+", this)"))),Dialogify.alert(e.message)}}function platform_gather(e,t){egg.lightbox.close(),egg.ajax({url:"/ajax/collectNew.php",success:function(t){collectNew_rs(t,e)},param:"s="+t,method:"POST"})}function collectNew_rs(e,t){var a=e.getElementsByTagName("errMsg"),r=e.getElementsByTagName("fin"),n="";if(0!==a.length)n=a[0].firstChild.nodeValue,open_default("",n,'<input type="button" value="確定" onclick="egg.lightbox.close();" />');else if(r.length){var l=e.getElementsByTagName("html")[0].firstChild.nodeValue;egg("#collectNewArea").html(l),egg("#collectNewNum").get(0).innerHTML=parseInt(egg("#collectNewNum").get(0).innerHTML,10)+1,m3("collectNew"+t,'完成設定，已收藏至<a href="http://home.gamer.com.tw/platformbox.php?owner='+egg.cookie.get("BAHAID")+'" target="_blank" style="color:blue">遊戲動漫櫃</a>',"1")}else m3("collectNew"+t,'完成設定，已收藏至<a href="http://home.gamer.com.tw/platformbox.php?owner='+egg.cookie.get("BAHAID")+'" target="_blank" style="color:blue">遊戲動漫櫃</a>',"1")}function want2play(e){return User.Login.requireLogin()&&jQuery.ajax({url:"/ajax/getCSRFToken.php",cache:!1}).done(function(t){jQuery.post("/ajax/want2play.php",{s:e,token:t},function(t){rewant2play(t,e)})}),!1}function want2play2(e){return jQuery.ajax({url:"/ajax/getCSRFToken.php",cache:!1}).done(function(t){jQuery.post("/ajax/want2play.php",{s:e,token:t},function(t){rewant2play2(t,e)})}),!1}function rewant2play(e,t){var a=e.getElementsByTagName("errMsg"),r=e.getElementsByTagName("okMsg");0!==a.length?(msg=a[0].firstChild.nodeValue,Dialogify.alert(msg)):0!==r.length&&(jQuery("#w2pnum_"+t).text(parseInt(jQuery("#w2pnum_"+t).text(),10)+1),m4("w2p_"+t,'完成設定，已收藏至<a href="http://home.gamer.com.tw/acgbox.php?owner='+User.Login.getUserid()+'&status=0" target="_blank" style="color:blue"> 遊戲動漫櫃</a>',1),jQuery("#w2p_"+t).attr("onclick","m4('w2p_"+t+"', '已追蹤，後續情報將會主動通知您!', 1)"),jQuery("#w2p_"+t).attr("href","javascript:;"),0!==jQuery("#w2p_manyacg").length&&jQuery("#w2p_manyacg").text(parseInt(jQuery("#w2p_manyacg").text(),10)+1))}function rewant2play2(e,t){var a=e.getElementsByTagName("errMsg"),r=e.getElementsByTagName("okMsg");0!==a.length?(msg=a[0].firstChild.nodeValue,Dialogify.alert(msg)):0!==r.length&&(jQuery("#span_want2paly_"+t).text(parseInt(jQuery("#span_want2paly_"+t).text(),10)+1),m4("a_want2play_"+t,'完成設定，已收藏至<a href="http://home.gamer.com.tw/acgbox.php?owner='+User.Login.getUserid()+'&status=0" target="_blank" style="color:blue"> 遊戲動漫櫃</a>',1),jQuery("#a_want2play_"+t).attr("onclick","m4('a_want2play_"+t+"', '你已經收藏過，前往<a href=\"https://home.gamer.com.tw/acgbox.php?owner="+User.Login.getUserid()+'&status=0" target="_blank" style="color: blue;"> 遊戲動漫櫃</a>\', 1)'),jQuery("#a_want2play_"+t).attr("href","javascript:;"))}function m4(e,t,a){if(1===a){var r=document.createElement("div");r.id="m4txt",jQuery(r).attr("class","BH-note"),jQuery(r).css("top",jQuery("#"+e).offset().top-32+"px"),jQuery(r).css("left",jQuery("#"+e).offset().left+"px"),jQuery(r).css("z-index",100),jQuery(r).html(t),jQuery(r).appendTo(document.body),setTimeout("m4('','','2')",3e3)}else try{document.body.removeChild(egg("#m4txt").get(0))}catch(n){}return!1}function Star_now(e,t,a,r,n){jQuery("[name=ACGStar]").eq(0).attr("class","ACG-Star"+e),jQuery("[name=ACGStar]").eq(1).attr("class","ACG-Star"+t),jQuery("[name=ACGStar]").eq(2).attr("class","ACG-Star"+a),jQuery("[name=ACGStar]").eq(3).attr("class","ACG-Star"+r),jQuery("[name=ACGStar]").eq(4).attr("class","ACG-Star"+n)}