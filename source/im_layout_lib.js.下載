(function(I,k,i,L){function p(e,s,t,l){return this instanceof p?this.init(e,s,t,l):new p(e,s,t,l)}function S(e){return typeof e<"u"?"&v="+e:""}p.prototype.init=function(e,s,t,l){var c=this;this.im=e,this.layout=t,this.im_id=s,this.layout_id=l,this.tip=null,this.tip2=[]},p.prototype.showNoRead=function(e){var s=e.noreadnum;return e.type==2?s>0?"New":"":s>999?"999+":s>0?s:""},p.prototype.showFightImg=function(e){var s=this,t=this.im.msgData[e],l=new Image;l.onload=function(){var c=i("#fightImg_"+e),o=c.parent().parent().parent().parent().parent().scrollTop();l.width>=l.height?(c.attr("width",l.height/.875).attr("height",l.height).css("max-width","100%"),ctx=c.get(0).getContext("2d"),ctx.drawImage(l,(l.height/.875-l.width)/2,0)):(c.attr("width",l.width).attr("height",l.width*.875).css("max-width","100%"),ctx=c.get(0).getContext("2d"),ctx.drawImage(l,0,(l.width*.875-l.height)/2)),(c.parent().parent().parent().parent().position().top<0||s.layout.isDown==!0)&&c.parent().parent().parent().parent().parent().scrollTop(o+c.height()-150);var a=JSON.parse(t.text_data);a.forEach(function(r){var d=r.text_size*c.get(0).height*.99,n=r.text_position_x*c.get(0).width,u=r.text_position_y*c.get(0).height;ctx.setTransform(1,0,0,1,0,0),ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="bold "+d+"px Microsoft JhengHei";for(var m=r.text.split(""),v=[],h="",g=0,_=0;_<m.length;_++)ctx.measureText(h+m[_]).width<=c.get(0).width&&m[_]!=`
`?h+=m[_]:(ctx.measureText(h).width>g&&(g=ctx.measureText(h).width),v.push(h.replace(`
`,"")),h=m[_]);v.push(h.replace(`
`,"")),ctx.measureText(h).width>g&&(g=ctx.measureText(h).width),ctx.translate(n+g/2,u+d*v.length/2),ctx.rotate(Math.PI/180*r.text_angle),ctx.translate(-g/2,-d*v.length/2);for(var _=0;_<v.length;_++){var g=ctx.measureText(v[_]).width;ctx.fillStyle=r.text_color,ctx.fillText(v[_],g/2,d/2+d*1.19*_),r.text_has_stroke==!0&&(ctx.strokeStyle=r.text_stroke_color,ctx.strokeText(v[_],g/2,d/2+d*1.19*_))}})},l.src="https://im.bahamut.com.tw/sticker%2F"+t.sticker_group_id+"%2F"+t.sticker_id+".png?alt=media"},p.prototype.avatarUrl=function(e,s){return f(e,s,this)},p.prototype.avatarLink=function(e){return D(e)},p.prototype.addMember=function(){var e=this.im.roomInfo[this.im.nowRoom],s='<h3 class="modal__header--title">\u9080\u8ACB\u6210\u54E1</h3>',t=`<div class="modal-content">  <ul class="tab-nav removeTextNodes">    <li class="tab-item is-active">      <a href="javascript:;" onclick="jQuery('.tab-item.is-active').removeClass('is-active');jQuery(this).parent().addClass('is-active');jQuery('#addMemberSlick').slick('slickGoTo',jQuery(this).parent().parent().find('li').index(jQuery(this).parent()));">\u9080\u8ACB\u597D\u53CB</a>    </li>`;e.is_public===!0&&(t+=`    <li class="tab-item">      <a href="javascript:;" onclick="jQuery('.tab-item.is-active').removeClass('is-active');jQuery(this).parent().addClass('is-active');jQuery('#addMemberSlick').slick('slickGoTo',jQuery(this).parent().parent().find('li').index(jQuery(this).parent()));">\u884C\u52D5\u689D\u78BC</a>    </li>    <li class="tab-item">      <a href="javascript:;" onclick="jQuery('.tab-item.is-active').removeClass('is-active');jQuery(this).parent().addClass('is-active');jQuery('#addMemberSlick').slick('slickGoTo',jQuery(this).parent().parent().find('li').index(jQuery(this).parent()));">\u9080\u8ACB\u7DB2\u5740</a>    </li>`),t+=`    <li class="tab-item">      <a href="javascript:;" onclick="jQuery('.tab-item.is-active').removeClass('is-active');jQuery(this).parent().addClass('is-active');jQuery('#addMemberSlick').slick('slickGoTo',jQuery(this).parent().parent().find('li').index(jQuery(this).parent()));">\u641C\u5C0B ID</a>    </li>  </ul>  <div id="addMemberSlick">  <div class="tab-box" id="addMemberTabFriend">    <ul class="message-room-list subtitle">      <li class="message-room-list__item">        <a href="javascript:;" role="button" class="message-room-list-header" onclick="`+this.layout_id+`.listSlide('addMember_favorite',this);">          <div class="message-room-subname">\u6700\u611B</div>          <i class="material-icons">keyboard_arrow_up</i>        </a>        <ul class="message-room-sub-list" id="addMember_favorite">        </ul>      </li>    </ul>    <ul class="message-room-list subtitle">      <li class="message-room-list__item">        <a href="javascript:;" role="button" class="message-room-list-header" onclick="`+this.layout_id+`.listSlide('addMember_normal',this);">          <div class="message-room-subname">\u4E00\u822C</div>          <i class="material-icons">keyboard_arrow_up</i>        </a>        <ul class="message-room-sub-list" id="addMember_normal">        </ul>      </li>    </ul>    <ul class="message-room-list subtitle">      <li class="message-room-list__item">        <a href="javascript:;" role="button" class="message-room-list-header" onclick="`+this.layout_id+`.listSlide('addMember_1vs1',this);">          <div class="message-room-subname">\u79C1\u8A0A\u904E</div>          <i class="material-icons">keyboard_arrow_up</i>        </a>        <ul class="message-room-sub-list" id="addMember_1vs1">        </ul>      </li>    </ul>  </div>`,e.is_public===!0&&(t+=`  <div class="tab-box" id="addMemberTabQr">    <div class="invite-box">      <div class="invite__qr-code">      </div>      <script>jQuery('.invite__qr-code').qrcode({width:224,height:224,text:"https://haha.gamer.com.tw/index.php?room=`+this.im.rooms[this.im.nowRoom]+'"});<\/script>      <a class="mes-btn mes-btn-default" href="#" download="'+this.im.rooms[this.im.nowRoom]+`.png" onclick="this.href=jQuery('.invite__qr-code > canvas').get(0).toDataURL();">\u4E0B\u8F09</a>    </div>  </div>  <div class="tab-box">    <div class="invite-box">      <div class="invite__link">        <input type="text" class="mes-textbox" value="https://haha.gamer.com.tw/?room=`+this.im.rooms[this.im.nowRoom]+`" id="linkurl"/>      </div>      <button class="mes-btn mes-btn-default" onclick="jQuery('#linkurl').select();if(document.execCommand('copy')){jQuery(this).html('\u5DF2\u8907\u88FD\u5230\u526A\u8CBC\u7C3F');}else{jQuery(this).html('\u8907\u88FD\u5931\u6557\uFF0C\u8ACB\u624B\u52D5\u8907\u88FD\u4E0A\u9762\u7DB2\u5740');};">>\u8907\u88FD\u7DB2\u5740</button>    </div>  </div>`),t+='  <div class="tab-box">    <div class="modal-search-box">      <input type="text" class="mes-textbox"/>      <button class="mes-btn mes-btn-primary" onclick="'+this.im_id+`.addMemberSearchBahaid(jQuery(this).prev('input').val());">\u641C\u5C0B</button>    </div>    <div class="modal-result-box" style="display:none" id="searchBahaid">      <div class="invite-box">        <div class="invite__author">          <a href="" target="_blank" class="author-avatar" id="searchBahaid_avatar">            <img src="" alt=""/>          </a>          <div class="author-username">            <p class="name" id="searchBahaid_name"></p>            <a class="id" id="searchBahaid_link" href="" target="_blank"></a>          </div>          <button class="mes-btn mes-btn-invese" onclick="`+this.im_id+`.addMember(jQuery('#searchBahaid_link').html(),jQuery('#searchBahaid_name').html());jQuery(this).hide();jQuery(this).next('p').show();">\u9080\u8ACB</button>          <p class="invite-tip__text" style="display:none">\u9080\u8ACB\u5DF2\u50B3\u9001\uFF01</p>        </div>      </div>    </div>  </div>  </div></div>`;var l='<div class="modal-ctrl rtl">  <a role="button" href="javascript:;" class="mes-btn mes-btn-default" onclick="'+this.layout_id+'.lightbox.close()">\u53D6\u6D88</a>  <a role="button" href="javascript:;" class="mes-btn mes-btn-primary" onclick="'+this.im_id+`.addMembers(jQuery('[name=mes-checkbox]:checked'));">\u9080\u8ACB</a></div>`;this.layout.lightbox=jQuery().lightBox({header:s,body:t,footer:l}),this.layout.lightbox.open(),jQuery("#addMemberSlick").slick({arrows:!1,draggable:!1,infinite:!1}).on("beforeChange",function(c,o,a,r){r==0?jQuery(".modal__footer").show():jQuery(".modal__footer").hide()}).find('input[type="text"]').click(function(){var c=i(this),o="static";c.css({position:"relative"}),setTimeout(function(){c.focus(),c.css({position:o})},0)}),this.addMemberSearchFriend("")},p.prototype.addMemberSearchFriend=function(e){async.series([function(s){this.im.getAllChatList(!0,s)}],function(){jQuery("#addMember_favorite").html(""),jQuery("#addMember_normal").html("");for(var s in this.im.rooms){var t=this.im.roomData[s];if(t.type==3){var l="",c="";for(var o in t.members)o!=User.Login.getUserid().toLowerCase()&&(l=o,c=t.members[o].name);if(!(e!=""&&l.match(e)==null&&t.name.match(e)==null)){if(t.is_favorite===!0&&t.is_friend!==!1)var a=jQuery("#addMember_favorite");else if(t.is_friend!==!1)var a=jQuery("#addMember_normal");else if(t.is_friend===!1&&t.has_chat===!0)var a=jQuery("#addMember_1vs1");else continue;var r='<li class="message-room-list__item">  <div class="user-panel dense data">    <div class="user-ctrl">      <div class="mes-checkbox">        <label class="mes-checkbox__label">          <input type="checkbox" name="mes-checkbox" value="'+l+'" data-nick="'+c+'">          <div class="mes-checkbox__button"></div>        </label>      </div>    </div>    <div class="user-avatar">      <div class="user-avatar__img" style="background-image: url('+f(l,"S",this)+');"></div>    </div>    <div class="user-container">      <div class="user-header">        <div class="user-title">          <span class="user-name">'+x(this.im.roomData[s].name)+'</span>        </div>      </div>      <div class="user-body">        <div class="message-summary">          <span>'+l+"</span>        </div>      </div>    </div>  </div></li>";a.append(r)}}}})},p.prototype.groupAdd_header=function(){return'<h3 class="modal__header--title">\u5EFA\u7ACB\u7FA4\u7D44</h3>'},p.prototype.groupEdit_header=function(){return'<h3 class="modal__header--title">\u7DE8\u8F2F\u7FA4\u7D44</h3>'},p.prototype.groupAdd_body=function(){return`<div class="modal-content">  <ul class="fields">    <li class="fidlds__item row">      <div class="fields-label col-2 col-wm-12">\u7FA4\u7D44\u5716\u7247\uFF1A</div>      <div class="fields-value col-10 col-wm-12">        <div class="mes-group-img-pre">        <img id="upimg">        </div>        <div class="mes-filebox">          <span>\u4E0A\u50B3\u5716\u7247</span>          <input type="file" class="mes-filebox__pre" onchange="jQuery('.modal__body').slick('slickGoTo',1);`+this.im_id+`.readFile(this)"/>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2 col-wm-12">\u7FA4\u7D44\u540D\u7A31\uFF1A</div>      <div class="fields-value col-10 col-wm-12">        <div class="mes-fields">          <input type="text" class="mes-textbox" name="group-name" value="" onkeyup="jQuery(this).next('span').html( jQuery(this).val().length + '/40' );" placeholder="\u7FA4\u7D44\u540D\u7A31"/>          <span class="mes-fields__tips">0/40</span>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2 col-wm-12">\u76F8\u95DC\u4F5C\u54C1\uFF1A</div>      <div class="fields-value col-10 col-wm-12">        <div class="relative-hlp">          <div class="mes-fields-value__text" name="group_relgame_span">\u5C1A\u672A\u8A2D\u5B9A</div>          <input type="hidden" value="0" name="group-c1" />          <input type="hidden" value="" name="group-relgame" />          <button class="mes-btn mes-btn-default" onclick="jQuery('.modal__body').slick('slickGoTo',2);">\u8A2D\u5B9A</button>          <span class="mes-fields__tips"><i class="material-icons">info_outline</i>\u6709\u95DC\u806F\u4F5C\u54C1\u4E26\u516C\u958B\u7684\u804A\u5929\u5BA4\uFF0C\u6703\u5728\u5C0D\u61C9\u7684\u54C8\u5566\u677F\u66DD\u5149</span>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2col-wm-12">\u804A\u5929\u5BA4\u8A2D\u5B9A\uFF1A</div>      <div class="fields-value col-10 col-wm-12 removeTextNodes">        <div class="mes-radio">          <label class="mes-radio__label">            <input type="radio" name="group-public" value="1" checked>            <div class="mes-radio__button"></div>            \u516C\u958B          </label>        </div>        <div class="mes-radio">          <label class="mes-radio__label">            <input type="radio" name="group-public" value="2">            <div class="mes-radio__button"></div>            \u79C1\u5BC6          </label>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2col-wm-12">\u9080\u8ACB\u597D\u53CB\uFF1A</div>      <div class="fields-value col-10 col-wm-12 removeTextNodes">        <div class="mes-fields-value__text" id="group_add_inviting_num">\u5DF2\u9078\u64C7 0 \u4EBA</div>        <button class="mes-btn mes-btn-default" onclick="jQuery('.modal__body').slick('slickGoTo',3);">\u9078\u64C7\u597D\u53CB</button>        <div class="avatar-box inline removeTextNodes" id="group_add_inviting"></div>      </div>    </li>  </ul></div><div class="modal-content">  <div class="modal__sub-header">    <a class="mes-btn mes-btn-link removeTextNodes modal-sub-ctrl-ltr" href="javascript:;" onclick="jQuery('.modal__body').slick('slickGoTo',0);">      <i class="material-icons">keyboard_arrow_left</i>      <span class="mes-btn-txt">\u8FD4\u56DE</span>    </a>    <div class="modal__sub-title">      \u88C1\u5207\u5716\u7247    </div>      <a class="mes-btn mes-btn-link modal-sub-ctrl-rtl" href="javascript:;" onclick="jQuery('.modal__body').slick('slickGoTo',0);jQuery('#upimg').attr('src',jQuery('#dimg').attr('src'));">\u5B8C\u6210</a>  </div>  <div class="group-setting-content">    <div id="simg" style="float:left;width:300px"></div>    <img id="dimg" style="float:right;">  </div></div><div class="modal-content">  <div class="modal__sub-header">    <div class="modal__sub-title">      \u641C\u5C0B\u76F8\u95DC\u4F5C\u54C1    </div>      <a class="mes-btn mes-btn-link modal-sub-ctrl-rtl" href="javascript:;" onclick="jQuery('.modal__body').slick('slickGoTo',0);">\u5B8C\u6210</a>  </div>  <div class="group-setting-content">    <div class="modal-search-box">      <input type="text" class="mes-textbox" id="group_search_key">      <button class="mes-btn mes-btn-primary" onclick="`+this.im_id+`.searchRelatedC1();">\u641C\u5C0B</button>    </div>    <div class="modal-result-box">      <div class="game-select removeTextNodes">        <div class="game-select__result">          \u76EE\u524D\u9078\u53D6\u4F5C\u54C1\uFF1A<span class="has-data" name="group_relgame_span">\u672A\u9078\u53D6</span>        </div>        <button class="mes-btn mes-btn-small mes-btn-default" onclick="jQuery('[name=group_relgame_span]').html('\u672A\u9078\u53D6');jQuery('[name=group-relgame]').val('');jQuery('').val(0);">\u6E05\u9664</button>      </div>      <ul class="game-result" id="group_relgame_search_list">      </ul>    </div>  </div></div><div class="modal-content">  <div class="modal__sub-header">    <a class="mes-btn mes-btn-link removeTextNodes modal-sub-ctrl-ltr" href="javascript:;" onclick="jQuery('.modal__body').slick('slickGoTo',0);">      <span class="mes-btn-txt">\u53D6\u6D88</span>    </a>    <div class="modal__sub-title">      \u9080\u8ACB\u597D\u53CB    </div>      <a class="mes-btn mes-btn-link modal-sub-ctrl-rtl" href="javascript:;" onclick="jQuery('.modal__body').slick('slickGoTo',0);`+this.layout_id+'.groupAddSetInviting();">\u9080\u8ACB</a>  </div>  <div class="group-setting-content">    <div class="modal-result-box" style="height:500px;overflow:auto">      <ul class="message-room-list subtitle">        <li class="message-room-list__item">          <a href="javascript:;" role="button" class="message-room-list-header" onclick="'+this.layout_id+`.listSlide('addMember_favorite',this);">            <div class="message-room-subname">\u6700\u611B</div>            <i class="material-icons">keyboard_arrow_up</i>          </a>          <ul class="message-room-sub-list" id="addMember_favorite">          </ul>        </li>      </ul>      <ul class="message-room-list subtitle">        <li class="message-room-list__item">          <a href="javascript:;" role="button" class="message-room-list-header" onclick="`+this.layout_id+`.listSlide('addMember_normal',this);">            <div class="message-room-subname">\u4E00\u822C</div>            <i class="material-icons">keyboard_arrow_up</i>          </a>          <ul class="message-room-sub-list" id="addMember_normal">          </ul>        </li>      </ul>      <ul class="message-room-list subtitle">        <li class="message-room-list__item">          <a href="javascript:;" role="button" class="message-room-list-header" onclick="`+this.layout_id+`.listSlide('addMember_1vs1',this);">            <div class="message-room-subname">\u79C1\u8A0A\u904E</div>            <i class="material-icons">keyboard_arrow_up</i>          </a>          <ul class="message-room-sub-list" id="addMember_1vs1">          </ul>        </li>      </ul>    </div>  </div></div>`},p.prototype.groupEdit_body=function(e){var s=this.im.roomInfo[e],t=this.im.roomData[e];return'<div class="modal-content">  <ul class="fields">    <li class="fidlds__item row">      <div class="fields-label col-2 col-wm-12">\u7FA4\u7D44\u5716\u7247\uFF1A</div>      <div class="fields-value col-10 col-wm-12">        <div class="mes-group-img-pre">          <img src="'+t.photo+`" alt="" id="upimg"/>        </div>        <div class="mes-filebox">          <span>\u91CD\u65B0\u4E0A\u50B3</span>          <input type="file" class="mes-filebox__pre" onchange="jQuery('.modal__body').slick('slickGoTo',1);im.readFile(this)"/>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2 col-wm-12">\u7FA4\u7D44\u540D\u7A31\uFF1A</div>      <div class="fields-value col-10 col-wm-12">        <div class="mes-fields">          <input type="text" class="mes-textbox" name="group-name" value="`+s.name+`" onkeyup="jQuery(this).next('span').html( jQuery(this).val().length + '/40' );" placeholder="\u7FA4\u7D44\u540D\u7A31"/>          <span class="mes-fields__tips">`+s.name.length+'/40</span>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2 col-wm-12">\u76F8\u95DC\u4F5C\u54C1\uFF1A</div>      <div class="fields-value col-10 col-wm-12">        <div class="relative-hlp">          <div class="mes-fields-value__text" name="group_relgame_span">'+x(s.related_acg_name)+'</div>          <input type="hidden" value="'+s.related_c1+'" name="group-c1" />          <input type="hidden" value="'+s.related_acg_name+`" name="group-relgame" />          <button class="mes-btn mes-btn-default" onclick="jQuery('.modal__body').slick('slickGoTo',2);">\u8A2D\u5B9A</button>          <span class="mes-fields__tips"><i class="material-icons">info_outline</i>\u6709\u95DC\u806F\u4F5C\u54C1\u4E26\u516C\u958B\u7684\u804A\u5929\u5BA4\uFF0C\u6703\u5728\u5C0D\u61C9\u7684\u54C8\u5566\u677F\u66DD\u5149</span>        </div>      </div>    </li>    <li class="fidlds__item row">      <div class="fields-label col-2col-wm-12">\u804A\u5929\u5BA4\u8A2D\u5B9A\uFF1A</div>      <div class="fields-value col-10 col-wm-12 removeTextNodes">        <div class="mes-radio">          <label class="mes-radio__label">            <input type="radio" name="group-public" value="1" `+(s.is_public?"checked":"")+'>            <div class="mes-radio__button"></div>            \u516C\u958B          </label>        </div>        <div class="mes-radio">          <label class="mes-radio__label">            <input type="radio" name="group-public" value="2" '+(s.is_public?"":"checked")+`>            <div class="mes-radio__button"></div>            \u79C1\u5BC6          </label>        </div>      </div>    </li>  </ul></div><div class="modal-content">  <div class="modal__sub-header">    <a class="mes-btn mes-btn-link removeTextNodes modal-sub-ctrl-ltr" href="javascript:;" onclick="jQuery('.modal__body').slick('slickGoTo',0);">      <i class="material-icons">keyboard_arrow_left</i>      <span class="mes-btn-txt">\u8FD4\u56DE</span>    </a>    <div class="modal__sub-title">      \u88C1\u5207\u5716\u7247    </div>      <a class="mes-btn mes-btn-link modal-sub-ctrl-rtl" href="javascript:;" onclick="jQuery('.modal__body').slick('slickGoTo',0);jQuery('#upimg').attr('src',jQuery('#dimg').attr('src'));">\u5B8C\u6210</a>  </div>  <div class="group-setting-content">    <div id="simg" style="float:left;width:300px"></div>    <img id="dimg" style="float:right;">  </div></div><div class="modal-content">  <div class="modal__sub-header">    <div class="modal__sub-title">      \u641C\u5C0B\u76F8\u95DC\u4F5C\u54C1    </div>      <a class="mes-btn mes-btn-link modal-sub-ctrl-rtl" href="javascript:;" onclick="jQuery('.modal__body').slick('slickGoTo',0);">\u5B8C\u6210</a>  </div>  <div class="group-setting-content">    <div class="modal-search-box">      <input type="text" class="mes-textbox" id="group_search_key">      <button class="mes-btn mes-btn-primary" onclick="im.searchRelatedC1();">\u641C\u5C0B</button>    </div>    <div class="modal-result-box">      <div class="game-select removeTextNodes">        <div class="game-select__result">          \u76EE\u524D\u9078\u53D6\u4F5C\u54C1\uFF1A<span class="has-data" name="group_relgame_span">`+x(s.related_acg_name)+`</span>        </div>        <button class="mes-btn mes-btn-small mes-btn-default" onclick="jQuery('[name=group_relgame_span]').html('\u672A\u9078\u53D6');jQuery('[name=group-relgame]').val('');jQuery('').val(0);">\u6E05\u9664</button>      </div>      <ul class="game-result" id="group_relgame_search_list">      </ul>    </div>  </div></div>`},p.prototype.groupAdd_foot=function(){return'<div class="modal-ctrl rtl">  <a role="button" href="javascript:;" class="mes-btn mes-btn-default" onclick="'+this.layout_id+'.lightbox.close();">\u53D6\u6D88</a>  <a role="button" href="javascript:;" class="mes-btn mes-btn-primary" onclick="'+this.im_id+'.groupAdd()">\u65B0\u589E</a></div>'},p.prototype.groupEdit_foot=function(){return'<div class="modal-ctrl rtl">  <a role="button" href="javascript:;" class="mes-btn mes-btn-default" onclick="'+this.layout_id+'.lightbox.close();">\u53D6\u6D88</a>  <a role="button" href="javascript:;" class="mes-btn mes-btn-primary" onclick="'+this.im_id+'.groupEdit()">\u5132\u5B58</a></div>'},p.prototype.editSticker=function(){var e=this,s='<div class="modal-content modal-content--h-limit">  <div class="modal__sub-header">    <div class="modal-sub-ctrl-rtl">      \u5168\u9078<div class="mes-switch padding-both">        <label class="mes-switch__label">          <input type="checkbox" name="mes-switch" onchange="'+this.im_id+`.editSticker('all',this);">          <div class="mes-switch__button"></div>        </label>      </div>    </div>  </div>  <ul class="message-room-list">`,t=" is-disable",l=[];this.im.stickers.forEach(function(d,n){d.sticker_visible==!1?l.push({key:n,sort:1e5+n/1e5}):l.push({key:n,sort:d.sticker_order+n/1e5})}),l.sort(function(d,n){return d.sort<n.sort?-1:1});for(var c in l){var o=l[c].key,a=this.im.stickers[o],r=this.im.stickerDetail[o];r&&(r.deadline<new Date().getTime()&&r.deadline!=0&&(t=""),s+='<li class="message-room-list__item">  <div class="user-panel dense data">    <div class="user-avatar user-avatar--square">      <div class="user-avatar__img" style="background-image: url(https://im.bahamut.com.tw/sticker%2F'+o+"%2Fsticker_"+o+'.png?alt=media);"></div>    </div>    <div class="user-container">      <div class="user-header">        <div class="user-title">          <span class="user-name">'+r.sticker_group_name+'</span>        </div>      </div>      <div class="user-body">        <div class="message-summary">          <span>\u8CBC\u5716\u671F\u9650\uFF1A'+(r.deadline==0?"\u6C38\u4E45":w(r.deadline-1,"sticker_dealine"))+'</span>        </div>      </div>    </div>    <div class="user-ctrl">      <div class="mes-switch">        <label class="mes-switch__label">          <input type="checkbox" name="mes-switch" onchange="'+this.im_id+".editSticker('"+o+`',this);" `+(a.sticker_visible==!1?"":"checked")+'>          <div class="mes-switch__button"></div>        </label>      </div>    </div>  </div></li>')}s+="</ul></div>",this.layout.lightbox&&this.layout.lightbox.close(),this.layout.lightbox=jQuery().lightBox({header:'<h3 class="modal__header--title">\u9078\u64C7\u8981\u986F\u793A\u7684\u8CBC\u5716</h3>',body:s,footer:'<a href="javascript:;" class="mes-btn mes-btn-link'+t+'" onclick="'+this.im_id+`.clearSticker('all');">\u6E05\u9664\u6240\u6709\u904E\u671F\u8CBC\u5716</a>`,footerClass:"modal__footer--general"}),setTimeout(function(){e.layout.lightbox.open()},200)},p.prototype.updateSticker=function(e){let s=this;this.tip!=null&&setTimeout(function(){tippy.delegate?(s.tip.destroy(),s.tip2.forEach(function(t){t.destroy()})):(s.tip.destroyAll(),s.tip2.forEach(function(t){t.destroyAll()}))},0)},p.prototype.changeStickerFans=function(e){i("a[data-sticker-group]").hide(),i("a[data-sticker-group="+e+"]").each(function(s,t){i(t).find("img").attr("src",i(t).find("img").attr("data-src"))}),i("a[data-sticker-group="+e+"]").show()},p.prototype.showStickerFans=function(){var e=this,s="",t=localStorage.hahamut_stickered||"[]";t=JSON.parse(t),t.forEach(function(n){s+='<a data-sticker-group="0" href="javascript:'+e.im_id+".sendSticker('"+n.sticker_group+"','"+n.sticker_img+`');$('.btn-emotion-active').click();">  <img src="https://im.bahamut.com.tw/sticker%2F`+n.sticker_group+"%2F"+n.sticker_img+'.png?alt=media" class="emotion-img"></a>'});var l=[];e.im.stickers.forEach(function(n,u){n.sticker_visible!=!1&&l.push({key:u,sort:n.sticker_order+u/1e5})}),l.sort(function(n,u){return n.sort<u.sort?-1:1});var c='<a href="javascript:;" onclick="'+e.layout_id+'.layout_u.changeStickerFans(0)"><i class="emotion-item material-icons" style="font-size:48px">access_time</i></a>';for(var o in l){var a=l[o].key,r=e.im.stickerDetail[a];if(!(!r||r.deadline<new Date().getTime()&&r.deadline!=0)){c+='<a href="javascript:;" onclick="'+e.layout_id+".layout_u.changeStickerFans("+a+')"><img src="https://im.bahamut.com.tw/sticker%2F'+a+"%2Fsticker_"+a+'.png?alt=media" alt="img" class="emotion-item"></a>';for(var d in r.stickers)s+='<a data-sticker-group="'+a+'" href="javascript:'+e.im_id+".sendSticker('"+a+"','"+r.stickers[d]+`');$('.btn-emotion-active').click();" style="display:none">  <img data-src="https://im.bahamut.com.tw/sticker%2F`+a+"%2F"+r.stickers[d]+'.png?alt=media" class="emotion-img"></a>'}}return'<div class="emotion-area">'+s+'</div><div class="emotion-option">'+c+"</div>"},p.prototype.showSticker=function(e){var s=this;if(i(e).attr("data-tooltipped")==L){var t=k.createElement("div");if(t.innerHTML=G(s),tippy.delegate)s.tip=tippy(e,{appendTo:k.body,maxWidth:"calc(100%-20px)",theme:"default",allowHTML:!0,content:t,trigger:"click",interactive:!0,onShow:function(o){const a=i(o.popper);a.find("[name=stickerContent]").show(),a.find("[name=stickerContent]").slick({lazyLoad:"ondemand",arrows:!1,draggable:!1,infinite:!1,fade:!0}),a.find("[name=stickerContent]").on("beforeChange",function(r,d,n,u){i("[name=slickitem]").removeClass("is-active"),i("[name=slickitem]:eq("+(u+1)+")").addClass("is-active")}),a.find("[name=stickerContent]").on("lazyLoaded",function(r,d,n,u){var m=k.createElement("img");m.src=u,m.width=180,s.tip2.push(tippy(n[0],{allowHTML:!0,content:m,theme:"light"}))})},onShown:function(o){const a=i(o.popper);var r=6;a.find("#sticker_index li").size()<6&&(r=a.find("#sticker_index li").size()),a.find("#sticker_index").slick({infinite:!1,slidesToShow:r,slidesToScroll:r,asNavFor:"[name=stickerContent]"}),a.find("[name=stickerContent]").slick("setPosition"),a.find("#sticker_index").slick("setPosition")},onHide:function(o){const a=i(o.popper);a.find("[name=stickerContent]").hide(),a.find("[name=stickerContent]").slick("unslick"),a.find("#sticker_index").slick("unslick")}}),s.tip.show();else{s.tip=tippy(e,{theme:"default",html:t,arrow:!0,trigger:"click",interactive:!0,animation:"fade",onShow:function(){i(this).find("[name=stickerContent]").show(),i(this).find("[name=stickerContent]").slick({lazyLoad:"ondemand",arrows:!1,draggable:!1,infinite:!1,fade:!0}),i(this).find("[name=stickerContent]").on("beforeChange",function(o,a,r,d){i("[name=slickitem]").removeClass("is-active"),i("[name=slickitem]:eq("+(d+1)+")").addClass("is-active")}),i(this).find("[name=stickerContent]").on("lazyLoaded",function(o,a,r,d){var n=k.createElement("img");n.src=d,n.width=180,s.tip2.push(tippy(r[0],{html:n,arrow:!0,animation:"fade",theme:"light"}))})},onShown:function(){var o=6;i(this).find("#sticker_index li").size()<6&&(o=i(this).find("#sticker_index li").size()),i(this).find("#sticker_index").slick({infinite:!1,slidesToShow:o,slidesToScroll:o,asNavFor:"[name=stickerContent]"}),i(this).find("[name=stickerContent]").slick("setPosition"),i(this).find("#sticker_index").slick("setPosition")},onHide:function(){i(this).find("[name=stickerContent]").hide(),i(this).find("[name=stickerContent]").slick("unslick"),i(this).find("#sticker_index").slick("unslick")}});var l=i(e).get(0),c=s.tip.getPopperElement(l);s.tip.show(c)}}},p.prototype.createHtml=function(e,s,t,l){return b(e,s,t,l)},p.prototype.msgContent=function(e,s){return R(e,s,this)},p.prototype.showFightImgEdit=function(e,s){var t=this,l='<div class="stickeredit_image" id="stickerDiv" style="z-index:1">  <img src="https://im.bahamut.com.tw/sticker%2F'+e+"%2F"+s+'.png?alt=media"></div><div class="stickeredit_edit" style="z-index:1">  <div class="scroll-hidden text_input">    <textarea id="stickerText" class="stickeredit text_input" placeholder="\u8F38\u5165\u6230\u5716\u6587\u5B57">\u65E9\u5B89\uFF0C\u8A8D\u540C\u8ACB\u5206\u4EAB</textarea>  </div>  <div class="tool-icon">    <button type="bottom" class="add-name" id="addNick">\u52A0\u5165\u66B1\u7A31</button>    <div class="icons">      <a id="addText" class="add-text" href="javascript:;" alt="\u65B0\u589E\u6587\u5B57"></a>      <a id="deleteText" class="delete-text" href="javascript:;" alt="\u522A\u9664\u6587\u5B57"></a>    </div>  </div>  <div class="tabs">    <div class="tab">      <input type="radio" name="tabs" id="tab1" checked="checked">      <label for="tab1">\u586B\u8272</label>      <div class="tickets-tab-content">        <div class="color-ticket">          <div class="coloring">            <div class="color-item">              <span class="white" style="background: #FFFFFF;"></span>              <span style="background: #747D7E"></span>              <span style="background: #000000"></span>            </div>            <div class="color-item">              <span style="background: #F7C3C7"></span>              <span style="background: #E84341"></span>              <span style="background: #8A1712"></span>            </div>            <div class="color-item">              <span style="background: #FFEDC5"></span>              <span style="background: #F3942E"></span>              <span style="background: #8D4A15"></span>            </div>            <div class="color-item">              <span style="background: #FBF7C7"></span>              <span style="background: #F9EB30"></span>              <span style="background: #8D7F1C"></span>            </div>            <div class="color-item">              <span style="background: #D8EAD0"></span>              <span style="background: #7ABC62"></span>              <span style="background: #247B34"></span>            </div>            <div class="color-item">              <span style="background: #C8E6EE"></span>              <span style="background: #4CBFBF"></span>              <span style="background: #019BAD"></span>            </div>            <div class="color-item">              <span style="background: #C6E0F7"></span>              <span style="background: #4A87C6"></span>              <span style="background: #08468F"></span>            </div>            <div class="color-item">              <span style="background: #E1C3DF"></span>              <span style="background: #844A97"></span>              <span style="background: #5A1A6F"></span>            </div>          </div>        </div>      </div>    </div>    <div class="tab">      <input type="radio" name="tabs" id="tab2">      <label for="tab2">\u5916\u6846</label>      <div class="tickets-tab-content">        <div class="color-ticket">          <div class="outer-frame">            <div class="color-item">              <span class="white" style="background: #FFFFFF;"></span>              <span style="background: #747D7E"></span>              <span style="background: #000000"></span>            </div>            <div class="color-item">              <span style="background: #F7C3C7"></span>              <span style="background: #E84341"></span>              <span style="background: #8A1712"></span>            </div>            <div class="color-item">              <span style="background: #FFEDC5"></span>              <span style="background: #F3942E"></span>              <span style="background: #8D4A15"></span>            </div>            <div class="color-item">              <span style="background: #FBF7C7"></span>              <span style="background: #F9EB30"></span>              <span style="background: #8D7F1C"></span>            </div>            <div class="color-item">              <span style="background: #D8EAD0"></span>              <span style="background: #7ABC62"></span>              <span style="background: #247B34"></span>            </div>            <div class="color-item">              <span style="background: #C8E6EE"></span>              <span style="background: #4CBFBF"></span>              <span style="background: #019BAD"></span>            </div>            <div class="color-item">              <span style="background: #C6E0F7"></span>              <span style="background: #4A87C6"></span>              <span style="background: #08468F"></span>            </div>            <div class="color-item">              <span style="background: #E1C3DF"></span>              <span style="background: #844A97"></span>              <span class="non-color" style="background: #B3B3B3"></span>            </div>          </div>        </div>      </div>    </div>  </div></div>',c=new Dialogify(l,{size:"dialogify__fixedwidth stickeredit",useDialogForm:!1,closable:!1}).title("\u7DE8\u8F2F\u6230\u5716").buttons([{text:"\u53D6\u6D88",click:function(o){this.close()}},{text:"\u767C\u9001",type:Dialogify.BUTTON_PRIMARY,click:function(o){var a=[];i(".stickeredit_image .edit-text").each(function(r,d){var n=i(d).data("deg")||0,u={text:i(d).text().trim(),text_size:parseFloat(i(d).css("font-size"))/parseFloat(i(".stickeredit_image").height()),text_position_x:(parseFloat(i(d).css("left"))+8)/parseFloat(i(".stickeredit_image").width()),text_position_y:(parseFloat(i(d).css("top"))+8)/parseFloat(i(".stickeredit_image").height()),text_color:M(i(d).css("color")),text_angle:parseInt(n)};i(d).css("-webkit-text-stroke-width")!="0px"?(u.text_has_stroke=!0,u.text_stroke_color=M(i(d).css("-webkit-text-stroke-color"))):u.text_has_stroke=!1,a.push(u)}),t.im.sendFightSticker(e,s,a),this.close()}}]).showModal();t.layout.updateSticker(),i("#addNick").click(function(){i("#stickerText").val(i("#stickerText").val()+t.im.nick),i(".stickeredit_image .is-active span").text(i("#stickerText").val())}),i("#addText").click(function(){i(".stickeredit_image .is-active").removeClass("is-active");var o=i("<div>"),a=i("<span>");a.text(i("#stickerText").val()),o.append(a),o.append('<div class="rotate-point bottom-r"><img src="https://im.bahamut.com.tw/hahamut%2Fim_zoom.svg?alt=media"></div><div class="rotate-point bottom-l"><img src="https://im.bahamut.com.tw/hahamut%2Fim_rotate.svg?alt=media"></div>'),o.addClass("edit-text"),o.addClass("is-active"),o.attr("style","top: 0; left: 0; font-size: 32px;color: #000000; -webkit-text-stroke: 1px #FFFFFF;"),o.click(N),i("#stickerDiv").append(o),o.jqDrag().jqResize(".bottom-r").jqRotate(".bottom-l")}),i("#addText").click(),i("#deleteText").click(function(){i("#stickerText").val(""),i("#stickerDiv .is-active").remove()}),i("#stickerText").keyup(function(){var o=i(".stickeredit_image .is-active");i(".stickeredit_image .is-active span").text(i("#stickerText").val())}),i(".coloring .color-item span").each(function(o,a){i(a).click(function(){i(".coloring .color-item span").removeClass("is-active"),i(a).addClass("is-active"),z(i(a).css("background-color"))})}),i(".outer-frame .color-item span").each(function(o,a){i(a).click(function(){i(".outer-frame .color-item span").removeClass("is-active"),i(a).addClass("is-active"),i(a).hasClass("non-color")?A(""):A(i(a).css("background-color"))})})};function z(e){i(".stickeredit_image .is-active").css("color",e)}function A(e){e==""?i(".stickeredit_image .is-active").css("-webkit-text-stroke",""):i(".stickeredit_image .is-active").css("-webkit-text-stroke","1px "+e)}function M(e){var s=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete s[0];for(var t=1;t<=3;++t)s[t]=parseInt(s[t]).toString(16),s[t].length==1&&(s[t]="0"+s[t]);return"#"+s.join("").toUpperCase()}function N(e,s){i(e.target).hasClass("edit-text")&&(i(".stickeredit_image .is-active").removeClass("is-active"),i(e.target).addClass("is-active")),i(e.target).is("span")&&(i(".stickeredit_image .is-active").removeClass("is-active"),i(e.target).parent().addClass("is-active"))}p.stickerSlickChange=function(){let e=i(this).data("slick-index")||i(this).parents(".slick-slide").data("slick-index");i("[name=stickerContent]").slick("slickGoTo",e-1)};function G(e){var s="",t="",l=localStorage.hahamut_stickered||"[]";l=JSON.parse(l),t+='<div class="sticker-content"><ul class="sticker-list row">',l.forEach(function(m){var v=e.im.stickerDetail[m.sticker_group],h="";v&&(v.deadline>=new Date().getTime()||v.deadline==0)&&(v.sticker_can_battle==!0&&(h='<a class="sticker-list__edit" href="javascript:;" onclick="'+e.layout_id+".layout_u.showFightImgEdit('"+m.sticker_group+"', '"+m.sticker_img+`');"></a>`),t+='<li class="sticker-list__item col-3 col-padding">  <a class="sticker-list__link" href="javascript:'+e.im_id+".sendSticker('"+m.sticker_group+"','"+m.sticker_img+`');">    <img data-lazy="https://im.bahamut.com.tw/sticker%2F`+m.sticker_group+"%2F"+m.sticker_img+'.png?alt=media">  </a>  '+h+"</li>")}),t+="</ul></div>";var c=[];e.im.stickers.forEach(function(m,v){m.sticker_visible!=!1&&c.push({key:v,sort:m.sticker_order+v/1e5})}),c.sort(function(m,v){return m.sort<v.sort?-1:1});for(var o in c){var a=c[o].key,r=e.im.stickerDetail[a];if(r){var d="",n="";if(r.sticker_can_battle==!0&&(d="<span>\u6230</span>"),s+='<li class="tab-item" onclick="BAHA_IM_LAYOUT_LIB.stickerSlickChange.apply(this);">  <a name="slickitem" class="sticker-item" href="javascript:;">    <img src="https://im.bahamut.com.tw/sticker%2F'+a+"%2Fsticker_"+a+'.png?alt=media">    '+d+"  </a></li>",r.deadline>=new Date().getTime()||r.deadline==0){t+='<div class="sticker-content"><ul class="sticker-list row">',r.stickers.forEach(function(m){r.sticker_can_battle==!0&&(n='<a class="sticker-list__edit" href="javascript:;" onclick="'+e.layout_id+".layout_u.showFightImgEdit('"+a+"', '"+m+`');"></a>`),t+='<li class="sticker-list__item col-3 col-padding">  <a class="sticker-list__link" href="javascript:'+e.im_id+".sendSticker('"+a+"','"+m+`');">    <img data-lazy="https://im.bahamut.com.tw/sticker%2F`+a+"%2F"+m+'.png?alt=media">  </a>  '+n+"</li>"});var u="";r.sticker_link&&(u='    <div class="sticker-title__inner">\u76F8\u95DC\u9023\u7D50\uFF1A <a href="'+r.sticker_link.url+'" target="_blank">'+r.sticker_link.name+"</a></div>"),t+='  </ul>  <div class="sticker-title">    <div class="sticker-title__inner">\u8CBC\u5716\u540D\u7A31\uFF1A '+r.sticker_group_name+'</div>    <div class="sticker-title__inner">\u8CBC\u5716\u671F\u9650\uFF1A '+(r.deadline==0?"\u6C38\u4E45":w(r.deadline-1,"sticker"))+'</div>    <div class="sticker-title__inner">\u8CBC\u5716\u4F5C\u8005\uFF1A '+(r.sticker_author=="\u5B98\u65B9\u63D0\u4F9B"||r.sticker_author=="sysop"?"\u5B98\u65B9\u63D0\u4F9B":'<a href="https://home.gamer.com.tw/'+r.sticker_author+'" target="_blank">'+r.sticker_author+"</a>")+"</div>    "+u+"  </div></div>"}else t+='<div class="sticker-content">  <div class="sticker-status">    <p>\u8CBC\u5716\u671F\u9650\u65BC '+w(r.deadline-1,"sticker_dealine")+' \u904E\u671F\uFF0C\u5DF2\u7121\u6CD5\u4F7F\u7528\u3002</p>    <button type="" class="mes-btn mes-btn-primary" onclick="'+e.im_id+".clearSticker('"+a+`');">\u522A\u9664</button>  </div></div>`}}return'<div class="sticker-wrapper">  <div class="sticker-nav group">    <ul class="tab-nav mes-sticker-slide" id="sticker_index">    <li class="tab-item">      <a name="slickitem" class="sticker-item" href="https://haha.gamer.com.tw/?room=sticker&type=recommend" target="_blank">        <i class="material-icons">storefront</i>      </a>    </li>    <li class="tab-item" onclick="BAHA_IM_LAYOUT_LIB.stickerSlickChange.apply(this);">      <a name="slickitem" class="sticker-item is-active" href="javascript:;">        <i class="material-icons">access_time</i>      </a>    </li>    '+s+'    </ul>    <!--button type="" class="btn-icon" onclick="'+e.layout_id+'.editSticker();"><i class="material-icons">settings</i></button-->  </div>  <div name="stickerContent">    '+t+"  </div></div>"}function w(e,s){if(e==0)return"";var t=new Date,l=new Date(e),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=l.getFullYear(),a=t.getFullYear(),r=l.getMonth()+1,d=t.getMonth()+1,n=l.getDate(),u=t.getDate(),m=l.getHours(),v=l.getMinutes(),h=l.getSeconds();switch(r<10&&(r="0"+r),n<10&&(n="0"+n),d<10&&(d="0"+d),u<10&&(u="0"+u),m<10&&(m="0"+m),v<10&&(v="0"+v),h<10&&(h="0"+h),s){case"note":var g=r+"/"+n+" "+m+":"+v;break;case"sticker":var g=o+"/"+r+"/"+n;break;case"sticker_dealine":var g=o+"\u5E74"+r+"\u6708"+n+"\u65E5";break;default:if(a==o&&d==r&&u==n)var g=m+":"+v;else if(a==o)var g=r+"/"+n;else var g=o+"/"+r+"/"+n;break}return g}function E(e){return e?e.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(`
`,`
<br>`).replaceAll(/https?:\/\/[^\s"']+/,function(s){return/^https:\/\/.+?\.(?:jpe?g|gif|png|webp)(?:\?alt=media|)$/i.test(s)?b("a",{href:s,target:"_blank"},"img",b("img",{src:s,"data-img":"true","data-height":"0",style:"max-width:100%;max-height:400px"})):b("a",{href:s,target:"_blank"},"text",s)}):""}function x(e){return e?e.replaceAll("<","&lt;").replaceAll(">","&gt;"):""}function f(e,s,t){if(e){var l=new RegExp("^bot@"),c=new RegExp("^fans@");if(l.test(e)){if(e>User.Login.getUserid().toLowerCase())var o=User.Login.getUserid().toLowerCase()+"_"+e;else var o=e+"_"+User.Login.getUserid().toLowerCase();var a=F(t.im.rooms,o);return s=="S"?a==!1?"https://im.bahamut.com.tw/bot%2F"+e+"_s.png?alt=media":"https://im.bahamut.com.tw/bot%2F"+e+"_s.png?alt=media"+S(t.im.roomData[a].photo_version):a==!1?"https://im.bahamut.com.tw/bot%2F"+e+".png?alt=media":"https://im.bahamut.com.tw/bot%2F"+e+".png?alt=media"+S(t.im.roomData[a].photo_version)}else if(c.test(e)&&!c.test(User.Login.getUserid().toLowerCase())){if(e>User.Login.getUserid().toLowerCase())var o=User.Login.getUserid().toLowerCase()+"_"+e;else var o=e+"_"+User.Login.getUserid().toLowerCase();var a=F(t.im.rooms,o);return t.im.roomData[a].photo}else return e=e.toLowerCase(),s=="S"?"https://avatar2.bahamut.com.tw/avataruserpic/"+e.substr(0,1)+"/"+e.substr(1,1)+"/"+e+"/"+e+"_s.png":"https://avatar2.bahamut.com.tw/avataruserpic/"+e.substr(0,1)+"/"+e.substr(1,1)+"/"+e+"/"+e+".png"}}function D(e){if(e){var s=new RegExp("^[a-zA-Z]{1}[a-zA-Z0-9]{1,11}$"),t=new RegExp("^bot@"),l=new RegExp("^fans@");if(s.test(e))return"https://home.gamer.com.tw/"+e;if(t.test(e))return e=="bot@blackdesertm"?"https://prj.gamer.com.tw/2018/blackdesertm/":"javascript:;";if(l.test(e))return"javascript:;"}else return"javascript:;"}function F(e,s){var t=!1;return e.some(function(l,c){return l==s?(t=c,!0):!1}),t}function b(e,s,t,l){var c=k.createElement(e);return i.each(s,function(o,a){c.setAttribute(o,a)}),typeof l<"u"&&(t=="text"?i(c).text(l):i(c).html(l)),c.outerHTML}function R(e,s,t){var l=s.roomId,c=F(t.im.rooms,l);if(t.im_id=="im_forum")var o="message-scoller_forum",a="data-forum_time";else var o="message-scoller",a="data-time";var r=parseInt(s.timestamp/1e3);if(t.layout_id!="im_forum_layout")var d="<a class=mes-tooltip--link href=javascript:; onclick="+t.layout_id+".sendToOther('"+e+"');>\u8F49\u50B3</a>";else d="";t.im.roomInfo[c].type==2&&s.sender_id!=User.Login.getUserid().toLowerCase()?d+="<a class=mes-tooltip--link href=javascript:; onclick="+t.layout_id+".accuse('"+e+"');>\u6AA2\u8209</a>":t.im.roomInfo[c].type!=2&&t.im.roomInfo[c].type!=4&&s.type==0&&(d+="<a class=mes-tooltip--link href=javascript:; onclick="+t.layout_id+".noteAdd('"+e+"');>\u5132\u5B58\u5230\u8A18\u4E8B\u672C</a>");var n="";switch(s.type){case 0:n='<div class="message-log__item group">  <div class="msg-log">'+E(s.message)+'</div>  <div class="msg-toolbar">    <div class="msg-toolbar__item">      <a href="javascript:;" data-hastip="true" class="btn-icon" data-tippy-content="'+d+'" title="'+d+'">        <i class="material-icons">more_horiz</i>      </a>    </div>  </div></div>';break;case 1:var u="",m="";if(s.thumbnail)u=s.thumbnail,m=s.thumbnail;else{var v="jpg";s.image_ext&&(v=s.image_ext),s.image_id?(m="https://im.bahamut.com.tw/chatimg%2F"+s.image_id+"."+v+"?alt=media&w=300&h=300",u="https://im.bahamut.com.tw/chatimg%2F"+s.image_id+"."+v+"?alt=media"):(m="https://im.bahamut.com.tw/room%2Fchat_image%2F"+l+"%2F"+e+"."+v+"?alt=media&w=300&h=300",u="https://im.bahamut.com.tw/room%2Fchat_image%2F"+l+"%2F"+e+"."+v+"?alt=media")}n='<div class="message-log__item group">  <div class="msg-log msg-log--photo">'+b("a",{href:u,target:"_blank"},"img",b("img",{src:m,onerror:"this.src='"+u+"';this.onerror=''","data-img":"true","data-height":"0"}))+'  </div>  <div class="msg-toolbar">    <div class="msg-toolbar__item">      <a href="javascript:;" class="btn-icon" data-hastip="true" data-tippy-content="'+d+'" title="'+d+'">        <i class="material-icons">more_horiz</i>      </a>    </div>  </div></div>';break;case 2:n='<div class="message-log__item group">  <div class="msg-log msg-log--sticker">'+b("img",{src:"https://im.bahamut.com.tw/sticker%2F"+s.sticker_group_id+"%2F"+s.sticker_id+".png?alt=media","data-img":"true","data-height":"0"})+"  </div></div>";break;case 4:n='<div class="mes-state-tip" '+a+'="'+s.timestamp+'" style="order:'+r+'">'+b("div",{class:"mes-state-tip__inline"},"text",H(s))+"</div>";break;case 7:var h=JSON.parse(s.events),g='<svg class="ic-sword" width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>ic_sword</title><path d="M3.41152954,0.00422515905 L3.4157547,-3.82804899e-13 L15.1544945,11.7387398 L15.8932343,11 L17.9234238,13.0301895 L16.6066208,14.3469925 L18.635582,16.3759536 L19.009964,16.0015717 L20.0457458,17.0373535 L17.0326996,20.0503998 L15.9969177,19.0146179 L16.3759536,18.635582 L14.3469925,16.6066208 L13.0301895,17.9234238 L11,15.8932343 L11.7387398,15.1544945 L0.00247497486,3.41822967 L0,3.41822967 L0,-8.8817842e-16 L3.41152954,-8.8817842e-16 L3.41152954,0.00422515905 Z" id="ic_sword"></path></svg>',_='<svg class="ic-shield" width="20px" height="22px" viewBox="3 0 18 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>ic_shield</title><path d="M12,1 L3,5 L3,11 C3,16.55 6.84,21.74 12,23 C17.16,21.74 21,16.55 21,11 L21,5 L12,1 Z" id="ic_shield"></path></svg>',y,C,B,T,Q,U;h[0].effects[User.Login.getUserid().toLowerCase()]!=L?y=User.Login.getUserid().toLowerCase():y=h[0].atter;for(var c in h[0].effects)c!=y&&(T=c,h[0].effects[c]=="att"?(Q=g,C=_):(Q=_,C=g));for(var c in h)h[c].battle_type==2&&(B=h[c].effects[y],U=h[c].effects[T]);n='<div class="mes-pk-poster-box" id="pk_'+e+'" '+a+'="'+s.timestamp+'" style="order:'+r+'">  <div class="mes-pk-poster">    <div class="mes-pk-poster__item author-avatar" '+(U=="win"?'data-pkwin="1"':"")+'>      <div class="pk-award">        <img src="https://im.bahamut.com.tw/hahamut%2Fic_award.png?alt=media">      </div>'+b("img",{src:f(T,"B",t)})+'      <div class="pk-states pk-states--l">'+Q+'</div>    </div>    <div class="mes-pk-poster__item">VS.</div>    <div class="mes-pk-poster__item author-avatar" '+(B=="win"?'data-pkwin="1"':"")+'>      <div class="pk-award">        <img src="https://im.bahamut.com.tw/hahamut%2Fic_award.png?alt=media">      </div>'+b("img",{src:f(y,"B",t)})+'      <div class="pk-states pk-states--r">'+C+'</div>    </div>  </div>  <div class="mes-pk-poster-tool">    <button type="button" class="mes-btn" onclick="'+t.layout_id+".startPK("+t.im_id+".msgData['"+e+`'],0)">      <i class="material-icons">play_arrow</i>      \u89C0\u770B\u904E\u7A0B    </button>    <button type="button" class="mes-btn" onclick="jQuery('#pk_`+e+` [data-pkwin]').addClass('pk-winner')">      <i class="material-icons">format_list_bulleted</i>      \u5C0D\u6230\u7D50\u679C    </button>  </div></div>`;break;case 8:n='<div class="message-log__item group">  <div class="msg-log msg-log--sticker">    <canvas id="fightImg_'+e+'"></canvas>    <script>'+t.layout_id+".showFightImg('"+e+"');<\/script>  </div></div>";break;case 9:n='<div class="message-log__item group">  <div class="msg-log">'+E("\u60F3\u548C"+s.sender_name+`\u9032\u884C\u4E92\u52D5\uFF0C\u8ACB\u81F3\u300E\u5DF4\u54C8\u59C6\u7279 APP\u300F\u4E0A\u9032\u884C\u64CD\u4F5C!
https://prj.gamer.com.tw/app2u/bahaapp.html`)+'</div>  <div class="msg-toolbar">    <div class="msg-toolbar__item">      <a href="javascript:;" data-hastip="true" class="btn-icon" data-tippy-content="'+d+'" title="'+d+'">        <i class="material-icons">more_horiz</i>      </a>    </div>  </div></div>';break}if(n!=""){if(s.type==4||s.type==7)return n;var O=f(s.sender_id,"S",t);if(s.sender_id==User.Login.getUserid().toLowerCase()){var j="message-holder msg-rtl";s.type==5&&(j+=" msg-pk-rtl")}else{var j="message-holder";s.type==5&&(j+=" msg-pk")}var q='<div class="'+j+'" '+a+'="'+s.timestamp+'" id="msgDiv_'+e+'" style="order:'+r+'">  <div class="user-avatar message-icon">'+b("a",{href:D(s.sender_id),target:"_blank","data-gamercard-userid":s.sender_id,class:"gamercard"},"div",b("div",{class:"user-avatar__img",style:"background-image: url("+O+');"'}))+'  </div>  <div class="message-log">    <div class="message-log__header group">      <h4 class="msg-log-title">'+x(s.sender_name||s.sender_id)+' -</h4>      <div class="msg-log-time">'+w(s.timestamp)+"</div>    </div>"+n+"  </div></div>";return q}}function H(e){switch(e.system_message_type){case 0:rmsg=e.system_message_actor+" \u52A0\u5165\u7FA4\u7D44";break;case 1:rmsg=e.system_message_actor+" \u9000\u51FA\u7FA4\u7D44";break;case 2:rmsg=e.system_message_actor+" \u5EFA\u7ACB\u7FA4\u7D44";break;case 3:rmsg=e.system_message_actor+" \u66F4\u65B0\u7FA4\u7D44\u5716\u7247";break;case 4:rmsg=e.system_message_actor+" \u66F4\u65B0\u7FA4\u7D44\u540D\u7A31";break;case 5:rmsg=e.system_message_actor+" \u9080\u8ACB\u4E86 "+e.system_message_receiver;break;case 6:rmsg=e.system_message_actor+" \u628A "+e.system_message_receiver+"\u8E22\u51FA\u7FA4\u7D44";break;case 7:rmsg=e.system_message_text;break;case 8:rmsg=e.system_message_actor+" \u66F4\u65B0\u7FA4\u7D44\u76F8\u95DC\u4F5C\u54C1";break}return rmsg}typeof exports=="object"?module.exports=p:typeof define=="function"&&define.amd?define(function(){return p}):I.BAHA_IM_LAYOUT_LIB=p})(window,window.document,jQuery);
