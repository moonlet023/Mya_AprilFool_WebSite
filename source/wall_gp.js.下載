(function($,window){let isLike=false;let wallGp={};wallGp.getLikeCountAndStatus=function(url,callback){let vcode=getRandomVcode();$.ajax({type:"GET",url:`https://wall.gamer.com.tw/api/link_post.php?url=${url}`,xhrFields:{withCredentials:true}}).done(function(resp){if(resp.data&&resp.data.isLike){isLike=true}else{isLike=false}callback(resp.data)})};wallGp.like=async function(url,callback){let data={url:url,vcode:getRandomVcode()};if(isLike){Dialogify.confirm("確定要取消推嗎？",{ok:function(){data.d=1;gpAction(data,callback)},cancel:function(){return}})}else{gpAction(data,callback)}};function getRandomVcode(){let vcode=Cookies.get("ckAPP_VCODE");if(vcode!=undefined){return vcode}vcode="";for(let i=0;i<4;i++){vcode+=String(Math.floor(Math.random()*10))}Cookies.set("ckAPP_VCODE",vcode,{domain:"gamer.com.tw",path:"/",expires:14});return vcode}function showMessage(message){if(window.Dialogify){window.Dialogify.alert(message)}else{alert(message)}}function gpAction(data,callback){$.ajax({type:"POST",url:"https://wall.gamer.com.tw/api/link_post_like.php",xhrFields:{withCredentials:true},data:data}).done(function(resp){if(resp.error){if(resp.error.code==401&&window.User){window.User.Login.requireLogin()}else{showMessage(resp.error.message)}}else{if(!isLike){isLike=true}else{isLike=false}callback(isLike)}})}window.BahaWallGp=wallGp})(jQuery,window);