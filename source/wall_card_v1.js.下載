(function(i,t,p){"use strict";var o={};o.followFanspage=function(a,e){var l=m();p.set("ckAPP_VCODE",l,{domain:"gamer.com.tw",path:"/"}),t.ajax({type:"POST",url:"https://api.gamer.com.tw/ajax/wall/fanspage_follow.php?from="+e,xhrFields:{withCredentials:!0},data:{fid:a,vcode:l}}).done(function(r){r.error?r.error.code==401?i.User!==void 0?i.User.Login.requireLogin():BahamutJs.login!==void 0?BahamutJs.login():c(r.error.message):c(r.error.message):t(".article_gamercard .gamecard__follow").addClass("is-active").text("\u5DF2\u8FFD\u8E64")})},o.unfollowFanspage=function(a){let e=new Bahamut.Csrf;e.setCookie();let l=new FormData;l.append("fansId",a),l.append("type",2),l.append("class",2),fetch("https://wall.gamer.com.tw/app/v1/fans_join.php",{method:"post",body:l,headers:e.getFetchHeaders(),credentials:"include"}).then(r=>r.json()).then(r=>{if(r.error){c(r.error.message);return}t(".article_gamercard .gamecard__follow").removeClass("is-active").text("\u8FFD\u8E64")}).catch(r=>{c(r)})};function c(a){i.Dialogify?i.Dialogify.alert(a):alert(a)}function m(){for(var a="",e=0;e<4;e++)a+=String(Math.floor(Math.random()*10));return a}function f(){t(".article_gamercard").click(function(a){var e=t(a.target),l,r,s;e.hasClass("article_gamercard")?l=e:l=e.parents(".article_gamercard"),r=l.data("fanspage-id"),s=l.data("from"),e.hasClass("gamecard__follow")?(e.hasClass("is-active")?s.match(/^app_/)&&BahamutJs.wallUnfollow!==void 0?BahamutJs.wallUnfollow(r):o.unfollowFanspage(r):s.match(/^app_/)&&BahamutJs.wallFollow!==void 0?BahamutJs.wallFollow(r):o.followFanspage(r,s),a.preventDefault()):(i.open("https://wall.gamer.com.tw/fanpage.php?sn="+r),s.match(/^app_/)&&BahamutJs.fanspageCardClick(r))}),t(".article_gamercard .gamecard-img").imagefill({runOnce:!0,target:"a img"})}function g(a){var e=t(".article_gamercard");if(!(Array.isArray(a)||!e.length||!t("#wallFanspageCardTemplate").length)){e.append(t("#wallFanspageCardTemplate").html()),e.find(".gamecard__background").append('<img src="'+a.cover+'">'),e.find(".gamecard-img > a").append('<img src="'+a.propic+'">'),e.find(".gamecard-label-name").html(a.title),a.checkMark==4&&e.find(".gamecard-label-name").append('<span class="tick fa fa-check-circle"></span>');var l=a.follow.toFixed(1).replace(/\d(?=(\d{3})+\.)/g,"$&,").replace(/\.0$/,"");e.find(".gamecard-label-people > span").text(l);var r=[];if(Array.isArray(a.follower)&&(a.follower.forEach(function(n){n=n.toLowerCase();var h="https://avatar2.bahamut.com.tw/avataruserpic/"+n.charAt(0)+"/"+n.charAt(1)+"/"+n+"/"+n+"_s.png";r.push(t('<div class="gamecard__gamer"><a href="javascript:;"><img src="'+h+'"></a></div>')),r.push(i.document.createTextNode(`
`))}),r.length&&a.follow-5>0)){var s=Math.min(a.follow-5,99);r.push(t('<div class="gamecard__gamer gamecard__gamer-more">+'+s+"</div>"))}e.find(".gamecard__info").prepend(r),a.isFollow?e.find(".gamecard__follow").addClass("is-active").text("\u5DF2\u8FFD\u8E64"):e.find(".gamecard__follow").text("\u8FFD\u8E64"),f()}}function d(a){t.ajax({type:"GET",url:"https://wall.gamer.com.tw/api/fanpage.php",xhrFields:{withCredentials:!0},data:{fansId:a}}).done(function(e){e.data&&g(e.data)})}t(function(){var a=t(".article_gamercard");if(a.length!=0){var e=a.data("fanspage-id");a.is(":empty")?a.hasClass("lazyload")?a.on("lazybeforeunveil",function(l){d(e)}):d(e):f()}})})(window,jQuery,Cookies);
